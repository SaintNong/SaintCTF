{% import 'icons.html' as icons %}
{% extends "base.html" %}
{% block title %}Profile{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">

    <!-- Sweet alert 2 -->
    <!-- as lazy as normal alerts, better than you could make them yourself -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js" defer></script>

    <script src="https://unpkg.com/@popperjs/core@2" defer></script>
    <script src="https://unpkg.com/tippy.js@6" defer></script>

    <!-- Chart.js 3.5.1 with date-fns adapter -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js" defer></script>

    <!-- chartjs-plugin-zoom 2.0.1 with Hammer.js 2.0.8 (gesture recognition) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js" integrity="sha512-UXumZrZNiOwnTcZSHLOfcTs0aos2MzBWHXOHOuB0J/R44QB0dwY5JgfbvljXcklVf65Gc4El6RjZ+lnwd2az2g==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js" integrity="sha512-wUYbRPLV5zs6IqvWd88HIqZU/b8TBx+I8LEioQ/UC0t5EMCLApqhIAnUg7EsAzdbhhdgW07TqYDdH3QEXRcPOQ==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>

    <script src="{{ url_for('static', filename='js/utils.js') }}" defer></script>
    <script data-username="{{ displayed_user.username }}" data-datapoints='{{ graph_datapoints|tojson }}'
        src="{{ url_for('static', filename='js/profile.js') }}" defer></script>
{% endblock %}

{% block body %}
    <section id="user-profile-card">
        <h2 id="username-heading">{{ displayed_user.username }}</h2>
        <h2>Rank {{ rank }}</h2>
        <h2>{{ score }} Points</h2>
    </section>

    <div id="chart-container">
        <div class="chart-toolbar">
            {% set options = 'class="chart-help-icon"' %}
            <button onclick="chartHelpToast('{{ icons.cursor__1(options) | forceescape }}', '{{ icons.touch__1(options) | forceescape }}')" title="Chart help">{{ icons.help() }}</button>
            <button onclick="resetChartZoom()" title="Reset zoom">{{ icons.zoom__fit() }}</button>
        </div>
        <canvas id="score-history"></canvas>
    </div>

    <section class="card" id="recent-solves">
        <h2>Solves</h2>
        {% if solves %}
            <table class="solves-table">
                <thead>
                    <tr>
                        <th>Challenge</th>
                        <th></th>
                        <th>Category</th>
                        <th>Difficulty</th>
                        <th>Points</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for solve in solves %}
                    <tr>
                        <td><a href="{{ url_for('challenges') }}#{{ solve.challenge_id | challenge_anchor_id }}">{{ solve.challenge.name }}</a></td>
                        <td>{% if solve.first_blood %}<span title="First blood">üèÜ</span>{% endif %}</td>
                        <td>{{ solve.challenge.category }}</td>
                        <td>{{ solve.challenge.difficulty }}</td>
                        <td>{{ solve.challenge.points }}</td>
                        <td><time datetime="{{ solve.time.isoformat() }}">{{ solve.time_ago }}</time></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No solves yet :(</p>
        {% endif %}
    </section>
{% endblock %}
